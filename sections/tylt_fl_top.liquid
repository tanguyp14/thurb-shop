{% schema %}
{
  "name": "TYLT - FIRSTLOVE TOP",
  "settings": [
    {
      "type": "text",
      "id": "intro_text",
      "label": "Titre",
      "default": "Quel sera votre premier amour ?"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Couleur du fond",
      "default": "#186b84ff"
    },
    {
      "type": "image_picker",
      "id": "small_cloud_image",
      "label": "Petit Nuages"
    },
    {
      "type": "image_picker",
      "id": "large_cloud_image",
      "label": "Gros Nuage"
    }
  ],
  "blocks": [
    {
      "type": "text_block",
      "name": "Ville",
      "settings": [
        {
          "type": "text",
          "id": "ville_name",
          "label": "Ville",
          "default": "Nom de la ville"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "TYLT - FIRSTLOVE TOP"
    }
  ]
}
{% endschema %}

<!-- Dans votre section Liquid -->
<section class="tylt_fl_top" style="background-color:{{ section.settings.bg_color }};">
  <div class="tylt_fl_top__clouds">
    {% if section.settings.small_cloud_image %}
      <div class="tylt_fl_top__clouds__small one">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
      <div class="tylt_fl_top__clouds__small two">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
      <div class="tylt_fl_top__clouds__small tree">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
    {% endif %}
  </div>
  <div class="tylt_fl_top__text">
    <h1>{{ section.settings.intro_text }}</h1>
    <!-- Conteneur unique pour les villes -->
    <div class="tylt_fl_top__text__cities">
      <div class="tylt_fl_top__text__cities__display">
        <!-- Les noms de ville seront insérés ici par JavaScript -->
      </div>
    </div>
  </div>
</section>


<script>
  document.addEventListener('DOMContentLoaded', function() {
    const citiesContainer = document.querySelector('.tylt_fl_top__text__cities__display');
    const cityNames = [{% for block in section.blocks %}"{{ block.settings.ville_name | escape }}"{% unless forloop.last %},{% endunless %}{% endfor %}];

    cityNames.forEach((name, index) => {
      const cityElement = document.createElement('div');
      cityElement.className = 'tylt_fl_top__text__cities__city';

      name.split('').forEach((letter, letterIndex) => {
        const letterSpan = document.createElement('span');
        letterSpan.textContent = letter === ' ' ? '\u00A0' : letter; // Gère les espaces
        letterSpan.style.transitionDelay = `${letterIndex * 0.1}s`;
        cityElement.appendChild(letterSpan);
      });

      citiesContainer.appendChild(cityElement);
    });

    const cities = document.querySelectorAll('.tylt_fl_top__text__cities__city');
    let currentIndex = 0;

    function showNextCity() {
      cities.forEach(city => city.classList.remove('active'));
      cities[currentIndex].classList.add('active');
      currentIndex = (currentIndex + 1) % cities.length;
      setTimeout(showNextCity, 3000);
    }

    // Déclenchement au scroll (optionnel)
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          setTimeout(showNextCity, 500);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    observer.observe(document.querySelector('.tylt_fl_top'));
  });
</script>