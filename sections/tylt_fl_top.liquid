{% schema %}
{
  "name": "TYLT - FIRSTLOVE TOP",
  "settings": [
    {
      "type": "text",
      "id": "intro_text",
      "label": "Titre",
      "default": "Quel sera votre premier amour ?"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Couleur du fond",
      "default": "#186b84ff"
    },
    {
      "type": "image_picker",
      "id": "small_cloud_image",
      "label": "Petit Nuages"
    },
    {
      "type": "image_picker",
      "id": "large_cloud_image",
      "label": "Gros Nuage"
    }
  ],
  "blocks": [
    {
      "type": "text_block",
      "name": "Ville",
      "settings": [
        {
          "type": "text",
          "id": "ville_name",
          "label": "Ville",
          "default": "Nom de la ville"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "TYLT - FIRSTLOVE TOP"
    }
  ]
}
{% endschema %}

<!-- Dans votre section Liquid -->
<section class="tylt_fl_top" style="background-color:{{ section.settings.bg_color }};">
  <div class="tylt_fl_top__clouds">
    {% if section.settings.small_cloud_image %}
      <div class="tylt_fl_top__clouds__small one">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
      <div class="tylt_fl_top__clouds__small two">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
      <div class="tylt_fl_top__clouds__small tree">
        <img src="{{ section.settings.small_cloud_image | img_url: 'master' }}" alt="Petit Nuage">
      </div>
    {% endif %}
  </div>
  <div class="tylt_fl_top__text">
    <h1>{{ section.settings.intro_text }}</h1>
    <!-- Conteneur unique pour les villes -->
    <div class="tylt_fl_top__text__cities">
      <div class="tylt_fl_top__text__cities__display">
        <!-- Les noms de ville seront insérés ici par JavaScript -->
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialisation de Textillate pour chaque ville
    $('.tylt_fl_top__text__cities__city').each(function() {
      $(this).textillate({
        loop: false, // Pas de boucle pour une seule ville
        minDisplayTime: 2000, // Temps d'affichage minimum (ms)
        initialDelay: 0,
        autoStart: false,
        in: {
          effect: 'fadeInLeft', // Animation d'entrée (gauche à droite)
          delayScale: 1.5,
          delay: 50,
          sync: false,
          shuffle: false
        }
      });
    });

    // Gestion du défilement des villes
    const cities = $('.tylt_fl_top__text__cities__city');
    let currentIndex = 0;

    function showNextCity() {
      // Masquer la ville précédente
      cities.removeClass('active').css('transform', 'translateY(100%)');

      // Afficher la ville courante avec Textillate
      const currentCity = $(cities[currentIndex]);
      currentCity.addClass('active').css('transform', 'translateY(0)');
      currentCity.textillate('start');

      // Passer à la ville suivante après 3 secondes
      setTimeout(() => {
        currentIndex = (currentIndex + 1) % cities.length;
        showNextCity();
      }, 3000);
    }

    // Déclencher au scroll
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          showNextCity();
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });

    observer.observe(document.querySelector('.tylt_fl_top'));
  });
</script>
